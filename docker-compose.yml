version: '3'
services:

  account-db:
    image: mysql
    restart: always
    environment:
      MYSQL_ROOT_PASSWORD: accounts
      MYSQL_DATABASE: account-db
    volumes: 
      - account-data:/var/lib/mysql
    ports:
      - 3307:3306

  account-service:
    image: com.s63d/er-account-service:latest
    environment: 
      SPRING_PROFILES_ACTIVE: docker-compose
    ports: 
      - 8081:8080


  vehicle-db:
      image: mysql
      restart: always
      environment:
        MYSQL_ROOT_PASSWORD: accounts
        MYSQL_DATABASE: vehicle-db
      volumes: 
        - vehicle-data:/var/lib/mysql
      ports:
       - 3308:3306
  vehicle-service:
    image: com.s63d/er-vehicle-service:latest
    environment: 
      SPRING_PROFILES_ACTIVE: docker-compose
    ports: 
      - 8080:8080

  trip-db:
    image: mysql
    restart: always
    environment:
      MYSQL_ROOT_PASSWORD: accounts
      MYSQL_DATABASE: trip-db
    volumes: 
      - trip-data:/var/lib/mysql
    ports:
      - 3309:3306

  trip-service:
    image: com.s63d/er-trip-service:latest
    environment: 
      SPRING_PROFILES_ACTIVE: docker-compose
    ports: 
      - 8082:8080

  rabbitmq:
    image: rabbitmq:3.7-management-alpine
    hostname: rabbitmq
    ports:
      - 5672:5672
      - 15672:15672
  trip-consumer:
    image: com.s63d/er-trip-consumer:latest
    environment: 
      SPRING_PROFILES_ACTIVE: docker-compose
    ports: 
      - 8083:8080

volumes:
  account-data:
  vehicle-data:
  trip-data:
